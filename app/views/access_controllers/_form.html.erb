<%= form_with model: @access_controller, local: true do |f| %>
  <% if @access_controller.errors.any? %>
    <div class="alert alert-danger">
      <h5 class="alert-heading">Please fix the following errors:</h5>
      <ul class="mb-0">
        <% @access_controller.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="mb-3">
    <%= f.label :name, class: "form-label" %>
    <%= f.text_field :name, class: "form-control", required: true, placeholder: "e.g., Front Door, Shop Access" %>
    <div class="form-text">A unique name to identify this access controller.</div>
  </div>

  <div class="mb-3">
    <%= f.label :hostname, "Hostname / IP Address", class: "form-label" %>
    <%= f.text_field :hostname, class: "form-control", required: true, placeholder: "e.g., 192.168.1.100 or door1.local" %>
    <div class="form-text">The IP address or domain name used to connect via SSH.</div>
  </div>

  <div class="mb-3">
    <%= f.label :access_controller_type_id, "Controller Type", class: "form-label" %>
    <% if @access_controller_types.present? %>
      <%= f.collection_select :access_controller_type_id,
          @access_controller_types,
          :id,
          :name,
          { prompt: "Select a type..." },
          { class: "form-select", required: true } %>
      <div class="form-text">Select the controller type (defines the SSH script path).</div>
    <% else %>
      <div class="alert alert-warning mb-2">No access controller types exist yet. Create a type first.</div>
      <%= f.select :access_controller_type_id, [], {}, class: "form-select", disabled: true %>
    <% end %>
  </div>

  <div class="mb-3">
    <%= f.label :script_arguments, "Script Arguments (optional)", class: "form-label" %>
    <%= f.text_field :script_arguments, class: "form-control", placeholder: "e.g., --verbose --timeout=30" %>
    <div class="form-text">Arguments passed to the script after the action and before the hostname.</div>
  </div>

  <div class="mb-3">
    <%= f.label :access_token, "Access Token (optional)", class: "form-label" %>
    <%= f.text_area :access_token, class: "form-control", rows: 3, placeholder: "Will be passed as ACCESS_TOKEN" %>
    <div class="form-text">If set, the token will be passed via ENV as ACCESS_TOKEN. Newlines are preserved.</div>
  </div>

  <div class="mb-3">
    <%= f.label :description, class: "form-label" %>
    <%= f.text_area :description, class: "form-control", rows: 3, placeholder: "Optional description or notes about this controller..." %>
  </div>

  <div class="mb-3">
    <%= f.label :display_order, class: "form-label" %>
    <%= f.number_field :display_order, class: "form-control", min: 0, style: "max-width: 100px;" %>
    <div class="form-text">Lower numbers appear first in lists.</div>
  </div>

  <div class="mb-4">
    <div class="form-check">
      <%= f.check_box :enabled, class: "form-check-input" %>
      <%= f.label :enabled, "Enabled", class: "form-check-label" %>
    </div>
    <div class="form-text">Disabled controllers will not receive RFID key updates.</div>
  </div>

  <div class="d-flex gap-2">
    <%= f.submit @access_controller.persisted? ? "Update" : "Create", class: "btn btn-primary" %>
    <%= link_to "Cancel", access_controllers_path, class: "btn btn-outline-secondary" %>
  </div>
<% end %>
