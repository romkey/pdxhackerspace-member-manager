<%= turbo_frame_tag "unmatched-recharge-frame" do %>
  <div class="card shadow-sm border-0">
    <div class="card-header bg-body-tertiary d-flex justify-content-between align-items-center">
      <h2 class="h5 mb-0">Unmatched Recharge Payments (<%= count %>)</h2>
      <div class="d-flex gap-2">
        <%= link_to reports_unmatched_recharge_path(recharge_page: params[:recharge_page]),
            class: "btn btn-outline-secondary btn-sm",
            data: { turbo_frame: "unmatched-recharge-frame" } do %>
          <i class="bi bi-arrow-clockwise"></i> Reload
        <% end %>
      </div>
    </div>
    <div class="card-body">
      <% if payments.any? %>
        <p class="text-muted small mb-3">Payments that don't have a matching User record by Recharge customer ID (most recent first)</p>
        <%= render partial: 'recharge_payments_table', locals: { payments: payments } %>
        
        <% if pagy.pages > 1 %>
          <nav aria-label="Recharge payments pagination" class="mt-3">
            <ul class="pagination pagination-sm justify-content-center mb-0">
              <%# Previous %>
              <li class="page-item <%= 'disabled' unless pagy.prev %>">
                <% if pagy.prev %>
                  <%= link_to reports_unmatched_recharge_path(recharge_page: pagy.prev),
                      class: "page-link",
                      data: { turbo_frame: "unmatched-recharge-frame" } do %>
                    <i class="bi bi-chevron-left"></i>
                  <% end %>
                <% else %>
                  <span class="page-link"><i class="bi bi-chevron-left"></i></span>
                <% end %>
              </li>

              <%# Page numbers %>
              <% pagy.series.each do |item| %>
                <% if item == :gap %>
                  <li class="page-item disabled"><span class="page-link">...</span></li>
                <% elsif item.is_a?(Integer) %>
                  <li class="page-item">
                    <%= link_to item, reports_unmatched_recharge_path(recharge_page: item),
                        class: "page-link",
                        data: { turbo_frame: "unmatched-recharge-frame" } %>
                  </li>
                <% elsif item.is_a?(String) %>
                  <li class="page-item active"><span class="page-link"><%= item %></span></li>
                <% end %>
              <% end %>

              <%# Next %>
              <li class="page-item <%= 'disabled' unless pagy.next %>">
                <% if pagy.next %>
                  <%= link_to reports_unmatched_recharge_path(recharge_page: pagy.next),
                      class: "page-link",
                      data: { turbo_frame: "unmatched-recharge-frame" } do %>
                    <i class="bi bi-chevron-right"></i>
                  <% end %>
                <% else %>
                  <span class="page-link"><i class="bi bi-chevron-right"></i></span>
                <% end %>
              </li>
            </ul>

            <div class="text-center text-muted small mt-2">
              Showing <%= pagy.from %>-<%= pagy.to %> of <%= pagy.count %>
            </div>
          </nav>
        <% end %>
      <% else %>
        <p class="text-muted mb-0">All Recharge payments have matching User records.</p>
      <% end %>
    </div>
  </div>
  
  <%= render partial: 'recharge_modals' %>
<% end %>
