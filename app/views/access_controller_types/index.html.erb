<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="h3 mb-1">Access Controller Types</h1>
    <p class="text-muted mb-0">Manage controller types and SSH script configuration.</p>
  </div>
  <div class="d-flex gap-2">
    <%= link_to "New Access Controller Type", new_access_controller_type_path, class: "btn btn-primary" %>
    <%= link_to "Export users.json", export_users_access_controller_types_path, class: "btn btn-outline-primary", data: { turbo: false } %>
    <%= link_to "Back to Settings", settings_path, class: "btn btn-secondary" %>
  </div>
</div>

<% if @access_controller_types.any? %>
  <div class="card shadow-sm border-0">
    <div class="table-responsive">
      <table class="table mb-0 align-middle">
        <thead class="bg-body-tertiary">
          <tr>
            <th scope="col">Name</th>
            <th scope="col">Script Path</th>
            <th scope="col">Enabled</th>
            <th scope="col" class="text-end">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @access_controller_types.each do |type| %>
            <tr class="<%= 'table-secondary' unless type.enabled? %>">
              <td>
                <strong><%= type.name %></strong>
                <% if type.required_training_topics.any? %>
                  <br>
                  <small class="text-muted">
                    Requires:
                    <% type.required_training_topics.order(:name).each do |topic| %>
                      <span class="badge bg-info bg-opacity-25 text-info-emphasis"><%= topic.name %></span>
                    <% end %>
                  </small>
                <% end %>
              </td>
              <td><code><%= type.script_path %></code></td>
              <td>
                <% if type.enabled? %>
                  <span class="badge text-bg-success">Enabled</span>
                <% else %>
                  <span class="badge text-bg-secondary">Disabled</span>
                <% end %>
              </td>
              <td class="text-end">
                <div class="btn-group btn-group-sm">
                  <%= link_to "Edit", edit_access_controller_type_path(type), class: "btn btn-outline-secondary" %>
                  <%= button_to "Probe",
                      probe_access_controller_type_path(type),
                      method: :post,
                      class: "btn btn-outline-primary",
                      data: { turbo: false } %>
                  <%= button_to type.enabled? ? "Disable" : "Enable",
                      toggle_access_controller_type_path(type),
                      method: :post,
                      class: "btn btn-outline-#{type.enabled? ? 'warning' : 'success'}" %>
                  <%= button_to "Delete", access_controller_type_path(type),
                      method: :delete,
                      class: "btn btn-outline-danger",
                      data: { turbo_confirm: "Delete access controller type '#{type.name}'?" } %>
                </div>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
<% else %>
  <div class="card shadow-sm border-0">
    <div class="card-body text-center py-5">
      <i class="bi bi-gear display-4 text-muted mb-3 d-block"></i>
      <p class="text-muted mb-3">No access controller types configured yet.</p>
      <%= link_to "Add Your First Type", new_access_controller_type_path, class: "btn btn-primary" %>
    </div>
  </div>
<% end %>
