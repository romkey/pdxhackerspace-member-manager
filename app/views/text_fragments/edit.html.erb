<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="h3 mb-1">Edit Text Fragment</h1>
    <p class="text-muted mb-0">Key: <code><%= @text_fragment.key %></code></p>
  </div>
  <%= link_to "Back to Text Fragments", text_fragments_path, class: "btn btn-outline-secondary" %>
</div>

<div class="card shadow-sm border-0">
  <div class="card-body">
    <%= form_with model: @text_fragment, local: true do |form| %>
      <% if @text_fragment.errors.any? %>
        <div class="alert alert-danger">
          <ul class="mb-0">
            <% @text_fragment.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="mb-3">
        <%= form.label :title, class: "form-label fw-semibold" %>
        <%= form.text_field :title, class: "form-control" %>
      </div>

      <div class="mb-3">
        <%= form.label :content, "Content (HTML)", class: "form-label fw-semibold" %>
        <%= form.text_area :content, class: "form-control font-monospace", rows: 20, style: "font-size: 0.9rem;" %>
        <div class="form-text">
          You can use HTML tags like <code>&lt;h4&gt;</code>, <code>&lt;p&gt;</code>, <code>&lt;ul&gt;</code>, <code>&lt;li&gt;</code>, <code>&lt;strong&gt;</code>, etc.
        </div>
      </div>

      <div class="mb-3">
        <h5>Preview</h5>
        <div id="content-preview" class="card bg-body-tertiary">
          <div class="card-body">
            <%= sanitize(@text_fragment.content, tags: %w[h1 h2 h3 h4 h5 h6 p br strong b em i u s ul ol li a div span hr], attributes: %w[href target class style]) %>
          </div>
        </div>
      </div>

      <div class="d-flex gap-2">
        <%= form.submit "Save Changes", class: "btn btn-primary" %>
        <%= link_to "Cancel", text_fragments_path, class: "btn btn-outline-secondary" %>
      </div>
    <% end %>
  </div>
</div>

<script>
  // Live preview
  document.addEventListener('DOMContentLoaded', function() {
    const textarea = document.querySelector('textarea[name="text_fragment[content]"]');
    const preview = document.getElementById('content-preview').querySelector('.card-body');
    
    if (textarea && preview) {
      textarea.addEventListener('input', function() {
        preview.innerHTML = textarea.value;
      });
    }
  });
</script>
