<%# Status Panel - shows membership status information %>
<%# Params: user, show_dues (boolean) %>
<div class="card border-0 bg-body-tertiary">
  <div class="card-body text-center">
    <%# Active/Inactive Status %>
    <div class="mb-3">
      <% if user.active? %>
        <div class="display-6 text-success mb-2">
          <i class="bi bi-check-circle-fill"></i>
        </div>
        <h4 class="text-success mb-0">Active</h4>
      <% else %>
        <div class="display-6 text-secondary mb-2">
          <i class="bi bi-x-circle-fill"></i>
        </div>
        <h4 class="text-secondary mb-0">Inactive</h4>
      <% end %>
    </div>

    <% if user.membership_start_date.present? %>
      <div class="mb-3 text-muted">
        <i class="bi bi-calendar-check me-1"></i>
        Member since <%= user.membership_start_date.strftime('%B %Y') %>
      </div>
    <% end %>

    <hr>

    <%# Membership Details %>
    <div class="text-start">
      <% if user.membership_status == 'sponsored' %>
        <div class="mb-3">
          <small class="text-muted d-block">Sponsorship</small>
          <span class="badge text-bg-primary fs-6">Sponsored</span>
        </div>
      <% end %>

      <div class="mb-3">
        <small class="text-muted d-block">Payment Type</small>
        <span class="badge text-bg-info fs-6"><%= user.payment_type.humanize %></span>
      </div>

      <% if user.membership_plan.present? %>
        <div class="mb-3">
          <small class="text-muted d-block">Membership Plan</small>
          <strong><%= user.membership_plan.name %></strong>
          <br>
          <span class="text-muted">$<%= format('%.2f', user.membership_plan.cost) %>/<%= user.membership_plan.billing_frequency %></span>
        </div>
      <% end %>

      <% if local_assigns[:show_dues] %>
        <div class="mb-3">
          <small class="text-muted d-block">Dues Status</small>
          <% dues_badge_class = case user.dues_status
             when "current" then "success"
             when "lapsed" then "warning"
             when "inactive" then "secondary"
             when "unknown" then "secondary"
             else "secondary"
             end %>
          <span class="badge text-bg-<%= dues_badge_class %> fs-6"><%= user.dues_status.humanize %></span>
        </div>
      <% end %>

      <%# Reactivation options for lapsed members within grace period %>
      <% if user.within_reactivation_grace_period? %>
        <% plans_with_links = MembershipPlan.with_payment_link.ordered %>
        <% if plans_with_links.any? %>
          <div class="mt-3 pt-3 border-top">
            <div class="alert alert-warning py-2 mb-2">
              <i class="bi bi-exclamation-triangle me-1"></i>
              <strong>Membership Lapsed</strong>
            </div>
            <p class="small text-muted mb-2">
              Your last payment was <%= time_ago_in_words(user.most_recent_payment_date) %> ago.
              You can reactivate your membership by selecting a plan below:
            </p>
            <div class="d-grid gap-2">
              <% plans_with_links.each do |plan| %>
                <%= link_to plan.payment_link, class: "btn btn-outline-primary btn-sm", target: "_blank", rel: "noopener" do %>
                  <i class="bi bi-credit-card me-1"></i>
                  <%= plan.name %> - $<%= format('%.2f', plan.cost) %>/<%= plan.billing_frequency %>
                <% end %>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>

      <div>
        <small class="text-muted d-block">Membership Status</small>
        <% badge_class = case user.membership_status
           when "paying" then "success"
           when "guest" then "warning"
           when "banned" then "danger"
           when "deceased" then "dark"
           when "sponsored" then "primary"
           when "applicant" then "light text-dark"
           when "cancelled" then "secondary"
           when "unknown" then "secondary"
           else "secondary"
           end %>
        <span class="badge text-bg-<%= badge_class %> fs-6"><%= user.membership_status.humanize %></span>
      </div>
    </div>
  </div>
</div>
