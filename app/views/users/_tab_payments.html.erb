<%# Payments Tab %>
<%# Params: payments, pagy, user, show_payment_links (optional, defaults to false) %>
<div class="card shadow-sm border-0">
  <div class="card-body">
    <h2 class="h6 mb-3">Payment History</h2>
    <% if payments.any? %>
      <div class="table-responsive">
        <table class="table table-sm align-middle mb-0">
          <thead class="bg-body-tertiary">
            <tr>
              <th scope="col">Source</th>
              <th scope="col">Reference</th>
              <th scope="col">Status</th>
              <th scope="col">Amount</th>
              <th scope="col">Time</th>
            </tr>
          </thead>
          <tbody>
            <% payments.each do |payment| %>
              <tr>
                <td><span class="badge text-bg-secondary"><%= payment_source_label(payment) %></span></td>
                <td>
                  <% if local_assigns[:show_payment_links] %>
                    <%= link_to payment_identifier(payment), payment_show_path(payment) %>
                  <% else %>
                    <span class="text-muted"><%= payment_identifier(payment) %></span>
                  <% end %>
                </td>
                <td><span class="badge text-bg-secondary"><%= payment_status(payment).presence || "Unknown" %></span></td>
                <td><%= payment_amount(payment) || "â€”" %></td>
                <td><%= payment_processed_time(payment) ? l(payment_processed_time(payment), format: :long) : "n/a" %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
      <% if local_assigns[:pagy] && local_assigns[:user] %>
        <%= render 'shared/pagination', pagy: pagy, user: user, tab: :payments %>
      <% end %>
    <% else %>
      <p class="text-muted mb-0">No payments have been recorded yet.</p>
    <% end %>
  </div>
</div>
