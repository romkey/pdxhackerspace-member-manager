<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 class="h3 mb-1">Slack Users</h1>
    <p class="text-muted mb-0">
      <strong><%= @total_slack_users %></strong> members —
      <strong><%= @shared_email_count %></strong> share emails and
      <strong><%= @shared_name_count %></strong> share names with Authentik users
    </p>
  </div>
  <div class="d-flex gap-2">
    <%= button_to "Sync Slack users", sync_slack_users_path, method: :post, class: "btn btn-primary", data: { turbo: false } %>
  </div>
</div>

<div class="d-flex justify-content-end mb-3">
  <%= form_with url: slack_users_path, method: :get, local: true, class: "d-flex align-items-center gap-2" do |form| %>
    <div class="form-check">
      <%= form.check_box :show_bots, { class: "form-check-input", checked: @show_bots, onchange: "this.form.submit()" }, "1", "0" %>
      <%= form.label :show_bots, "Show bot users", class: "form-check-label" %>
    </div>
  <% end %>
</div>

<div class="card shadow-sm border-0">
  <div class="table-responsive">
    <table class="table mb-0 align-middle">
      <thead class="bg-body-tertiary">
        <tr>
          <th scope="col">Name</th>
          <th scope="col">Email</th>
          <th scope="col">Title</th>
          <th scope="col">Admin</th>
          <th scope="col">Owner</th>
          <th scope="col">Bot</th>
          <th scope="col">Status</th>
        </tr>
      </thead>
      <tbody>
        <% @slack_users.each do |user| %>
          <tr>
            <td class="fw-semibold">
              <%= link_to user.display_name, slack_user_path(user), class: "text-decoration-none" %>
            </td>
            <td>
              <% if user.email.present? %>
                <%= mail_to user.email %>
              <% else %>
                <span class="text-muted fst-italic">Not provided</span>
              <% end %>
            </td>
            <td><%= user.title.presence || "—" %></td>
            <td>
              <span class="badge text-bg-<%= user.is_admin? ? 'success' : 'secondary' %>">
                <%= user.is_admin? ? "Yes" : "No" %>
              </span>
            </td>
            <td>
              <span class="badge text-bg-<%= user.is_owner? ? 'success' : 'secondary' %>">
                <%= user.is_owner? ? "Yes" : "No" %>
              </span>
            </td>
            <td>
              <span class="badge text-bg-<%= user.is_bot? ? 'warning' : 'secondary' %>">
                <%= user.is_bot? ? "Bot" : "Human" %>
              </span>
            </td>
            <td>
              <span class="badge text-bg-<%= user.deleted? ? 'secondary' : 'success' %>">
                <%= user.deleted? ? "Disabled" : "Active" %>
              </span>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

