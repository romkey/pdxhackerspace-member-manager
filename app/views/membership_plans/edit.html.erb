<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h3 mb-0">Edit Membership Plan</h1>
  <%= link_to "&larr; Back to Membership Plans".html_safe, membership_plans_path, class: "text-decoration-none" %>
</div>

<div class="card shadow-sm border-0">
  <div class="card-body">
    <% if @membership_plan.errors.any? %>
      <div class="alert alert-danger">
        <ul class="mb-0">
          <% @membership_plan.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <%= form_with model: @membership_plan, url: membership_plan_path(@membership_plan), local: true, class: "row g-3" do |f| %>
      <div class="col-md-4">
        <%= f.label :name, "Plan Name", class: "form-label" %>
        <%= f.text_field :name, class: "form-control #{'is-invalid' if @membership_plan.errors.key?(:name)}", required: true %>
        <% if @membership_plan.errors.key?(:name) %>
          <div class="invalid-feedback">
            <%= @membership_plan.errors[:name].first %>
          </div>
        <% end %>
      </div>
      <div class="col-md-2">
        <%= f.label :cost, "Cost", class: "form-label" %>
        <%= f.number_field :cost, step: 0.01, min: 0, class: "form-control #{'is-invalid' if @membership_plan.errors.key?(:cost)}", required: true %>
        <% if @membership_plan.errors.key?(:cost) %>
          <div class="invalid-feedback">
            <%= @membership_plan.errors[:cost].first %>
          </div>
        <% end %>
      </div>
      <div class="col-md-3">
        <%= f.label :billing_frequency, "Billing Frequency", class: "form-label" %>
        <%= f.select :billing_frequency, 
            options_for_select([['Monthly', 'monthly'], ['Yearly', 'yearly'], ['One-time', 'one-time']], @membership_plan.billing_frequency),
            {},
            { class: "form-select #{'is-invalid' if @membership_plan.errors.key?(:billing_frequency)}", required: true } %>
        <% if @membership_plan.errors.key?(:billing_frequency) %>
          <div class="invalid-feedback">
            <%= @membership_plan.errors[:billing_frequency].first %>
          </div>
        <% end %>
      </div>
      <div class="col-md-3">
        <%= f.label :plan_type, "Plan Type", class: "form-label" %>
        <%= f.select :plan_type, 
            options_for_select([['Primary', 'primary'], ['Supplementary', 'supplementary']], @membership_plan.plan_type),
            {},
            { class: "form-select #{'is-invalid' if @membership_plan.errors.key?(:plan_type)}" } %>
        <% if @membership_plan.errors.key?(:plan_type) %>
          <div class="invalid-feedback">
            <%= @membership_plan.errors[:plan_type].first %>
          </div>
        <% end %>
      </div>
      <div class="col-md-6">
        <%= f.label :payment_link, "Payment Link", class: "form-label" %>
        <%= f.url_field :payment_link, class: "form-control", placeholder: "https://..." %>
        <div class="form-text">Public URL where members can pay for this plan.</div>
      </div>
      <div class="col-md-6">
        <%= f.label :paypal_transaction_subject, "PayPal Transaction Subject", class: "form-label" %>
        <%= f.text_field :paypal_transaction_subject, class: "form-control", placeholder: "e.g., Storage Space" %>
        <div class="form-text">Used to match PayPal payments to this plan.</div>
      </div>
      <div class="col-md-3">
        <div class="form-check mt-2">
          <%= f.check_box :manual, class: "form-check-input" %>
          <%= f.label :manual, "Manual", class: "form-check-label" %>
        </div>
        <div class="form-text">Dues are collected manually (cash, check, etc.)</div>
      </div>
      <div class="col-md-3">
        <div class="form-check mt-2">
          <%= f.check_box :visible, class: "form-check-input" %>
          <%= f.label :visible, "Visible to Members", class: "form-check-label" %>
        </div>
        <div class="form-text">Show this plan to non-admin members</div>
      </div>
      <div class="col-12" data-controller="rich-editor" data-rich-editor-variables-value="[]">
        <%= f.label :description, "Description", class: "form-label" %>
        <div class="mb-2">
          <small class="text-muted">Use the toolbar to format, or click "Source Code" (&lt;&gt;) to edit raw HTML.</small>
        </div>
        <%= f.text_area :description, class: "form-control", rows: 5, data: { rich_editor_target: "editor" } %>
      </div>
      <div class="col-12">
        <%= f.submit "Update Plan", class: "btn btn-primary" %>
        <%= link_to "Cancel", membership_plans_path, class: "btn btn-outline-secondary" %>
      </div>
    <% end %>
  </div>
</div>

