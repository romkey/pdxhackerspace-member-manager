<div class="mb-4 d-flex justify-content-between align-items-center">
  <div class="d-flex gap-2 align-items-center">
    <% if @previous_sheet_entry %>
      <%= link_to sheet_entry_path(@previous_sheet_entry), class: "btn btn-outline-secondary", title: "Previous: #{@previous_sheet_entry.name}" do %>
        <i class="bi bi-chevron-left"></i> Previous
      <% end %>
    <% else %>
      <span class="btn btn-outline-secondary disabled" title="First entry">
        <i class="bi bi-chevron-left"></i> Previous
      </span>
    <% end %>
    
    <% if @next_sheet_entry %>
      <%= link_to sheet_entry_path(@next_sheet_entry), class: "btn btn-outline-secondary", title: "Next: #{@next_sheet_entry.name}" do %>
        Next <i class="bi bi-chevron-right"></i>
      <% end %>
    <% else %>
      <span class="btn btn-outline-secondary disabled" title="Last entry">
        Next <i class="bi bi-chevron-right"></i>
      </span>
    <% end %>
    
    <%= button_to "Sync to Users", sync_to_user_sheet_entry_path(@sheet_entry), method: :post, class: "btn btn-outline-primary", data: { turbo: false } %>
  </div>
  
  <div>
    <%= link_to "&larr; Back to sheet entries".html_safe, sheet_entries_path, class: "text-decoration-none" %>
  </div>
</div>

<%= render "paypal_payments/payment_history", payments: @payments %>

<div class="card shadow-sm border-0">
  <div class="card-body">
    <h1 class="h4 mb-3"><%= @sheet_entry.name %></h1>

    <dl class="row mb-0">
      <dt class="col-sm-3 text-secondary">User</dt>
      <dd class="col-sm-9">
        <% if @sheet_entry.user.present? %>
          <%= link_to @sheet_entry.user.display_name, user_path(@sheet_entry.user), class: "text-decoration-none" %>
        <% else %>
          <span class="text-muted fst-italic">Not linked</span>
        <% end %>
      </dd>

      <dt class="col-sm-3 text-secondary">Email</dt>
      <dd class="col-sm-9">
        <% if @sheet_entry.email.present? %>
          <%= mail_to @sheet_entry.email %>
        <% else %>
          <span class="text-muted fst-italic">Not provided</span>
        <% end %>
      </dd>

      <dt class="col-sm-3 text-secondary">Status</dt>
      <dd class="col-sm-9"><%= @sheet_entry.status.presence || "—" %></dd>

      <dt class="col-sm-3 text-secondary">Dirty</dt>
      <dd class="col-sm-9"><%= @sheet_entry.dirty.presence || "—" %></dd>

      <dt class="col-sm-3 text-secondary">Twitter</dt>
      <dd class="col-sm-9"><%= @sheet_entry.twitter.presence || "—" %></dd>

      <dt class="col-sm-3 text-secondary">Alias</dt>
      <dd class="col-sm-9"><%= @sheet_entry.alias_name.presence || "—" %></dd>

      <dt class="col-sm-3 text-secondary">Date added</dt>
      <dd class="col-sm-9">
        <%= @sheet_entry.date_added ? l(@sheet_entry.date_added.to_date, format: :long) : "Unknown" %>
      </dd>

      <dt class="col-sm-3 text-secondary">Payment</dt>
      <dd class="col-sm-9"><%= @sheet_entry.payment.presence || "—" %></dd>

      <dt class="col-sm-3 text-secondary">PayPal name</dt>
      <dd class="col-sm-9"><%= @sheet_entry.paypal_name.presence || "—" %></dd>

      <dt class="col-sm-3 text-secondary">Notes</dt>
      <dd class="col-sm-9"><%= simple_format(@sheet_entry.notes.presence || "—") %></dd>

      <dt class="col-sm-3 text-secondary">Access</dt>
      <dd class="col-sm-9">
        <% if @sheet_entry.access_permissions.any? %>
          <ul class="list-unstyled mb-0">
            <% @sheet_entry.access_permissions.each do |permission| %>
              <li>• <%= permission %></li>
            <% end %>
          </ul>
        <% else %>
          <span class="text-muted fst-italic">None recorded</span>
        <% end %>
      </dd>

      <dt class="col-sm-3 text-secondary">Last synced</dt>
      <dd class="col-sm-9"><%= @sheet_entry.last_synced_at ? l(@sheet_entry.last_synced_at, format: :long) : "Never" %></dd>

      <dt class="col-sm-3 text-secondary">Raw data</dt>
      <dd class="col-sm-9">
        <pre class="bg-body-secondary rounded p-3 mb-0"><code class="text-body"><%= JSON.pretty_generate(@sheet_entry.raw_attributes) %></code></pre>
      </dd>
    </dl>
  </div>
</div>

